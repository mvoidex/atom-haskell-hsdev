"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const atom_1 = require("atom");
const Util = require("../util");
const hsdev_process_real_1 = require("./hsdev-process-real");
const hsdev_process_real_factory_1 = require("./hsdev-process-real-factory");
class HsDevProcess {
    constructor(upiPromise) {
        this.upiPromise = upiPromise;
        this.disposables = new atom_1.CompositeDisposable();
        this.emitter = new atom_1.Emitter();
        this.disposables.add(this.emitter);
        this.bufferDirMap = new WeakMap();
        this.backend = this.startBackend();
    }
    async getRootDir(buffer) {
        let dir;
        dir = this.bufferDirMap.get(buffer);
        if (dir) {
            return dir;
        }
        dir = await Util.getRootDir(buffer);
        this.bufferDirMap.set(buffer, dir);
        return dir;
    }
    killProcess() {
        this.backend.killProcess();
    }
    destroy() {
        this.backend.destroy();
        this.emitter.emit('did-destroy');
        this.disposables.dispose();
    }
    onDidDestroy(callback) {
        return this.emitter.on('did-destroy', callback);
    }
    onWarning(callback) {
        return this.emitter.on('warning', callback);
    }
    onError(callback) {
        return this.emitter.on('error', callback);
    }
    onBackendActive(callback) {
        return this.emitter.on('backend-active', callback);
    }
    onBackendIdle(callback) {
        return this.emitter.on('backend-idle', callback);
    }
    onQueueIdle(callback) {
        return this.emitter.on('queue-idle', callback);
    }
    async whoat(buffer, crange) {
        const file = buffer.getUri();
        const line = crange.start.row + 1;
        const column = crange.start.column + 1;
        const symbols = await this.backend.whoat(file, line, column);
        if (symbols.length == 0) {
            Util.debug(`No info found for symbol at ${file} ${line} ${column}`);
            throw Error(`No info found for symbol at ${file} ${line} ${column}`);
        }
        else {
            const sym = symbols[0];
            const what = sym.info.what;
            const lines = [];
            switch (what) {
                case 'function':
                case 'method':
                case 'constructor':
                    lines.push(`${sym.id.name} :: ${sym.info.type ? sym.info.type : '?'}`);
                    break;
                case 'data':
                case 'type':
                case 'class':
                case 'newtype':
                    lines.push(`${what} ${sym.id.name}`);
                    break;
                default:
                    lines.push(`${sym.id.name}`);
            }
            if (sym.docs) {
                lines.push('', `{- ${sym.docs} -}`);
            }
            if (sym.id.module.location.file && sym.pos) {
                lines.push('', `-- Defined in ${sym.id.module.location.file}:${sym.pos.line}:${sym.pos.column}`);
            }
            return { range: crange, info: lines.join('\n') };
        }
    }
    async doPing() {
        this.backend.call('ping', undefined, {
            onResponse: (response) => {
                Util.debug(`response to ping: ${JSON.stringify(response)}`);
            }
        });
    }
    async checkAndLint(buffer) {
        const file = buffer.getUri();
        const messages = await this.backend.checkLint([file]);
        return this.convertMessages(messages);
    }
    async check(buffer) {
        const file = buffer.getUri();
        const messages = await this.backend.check([file]);
        return this.convertMessages(messages);
    }
    async lint(buffer) {
        const file = buffer.getUri();
        const messages = await this.backend.lint([file]);
        return this.convertMessages(messages);
    }
    convertMessages(messages) {
        const result = [];
        for (const message of messages) {
            const sev = (message.note.suggestion || message.level == 'hint') ? 'lint' : message.level;
            const lines = [message.note.message];
            if (message.note.suggestion) {
                const suggest = message.note.suggestion.split('\n');
                if (suggest.length == 1) {
                    lines.push(`Why not: ${suggest[0]}`);
                }
                else {
                    lines.push('Why not:', ...suggest);
                }
            }
            Util.debug();
            result.push({
                uri: message.source.file,
                position: new atom_1.Point(message.region.from.line - 1, message.region.from.column - 1),
                severity: sev,
                message: lines.join('\n')
            });
        }
        return result;
    }
    async getUPI() {
        return Promise.race([this.upiPromise, Promise.resolve(undefined)]);
    }
    startBackend() {
        const backend = new hsdev_process_real_1.HsDevProcessReal();
        backend.scanCabal({
            onNotify: async (_notification) => {
                const upi = await this.getUPI();
                if (upi) {
                    upi.setStatus({
                        status: 'progress',
                        detail: 'scanning global-db/user-db'
                    });
                }
            },
            onError: async (error, _details) => {
                const upi = await this.getUPI();
                if (upi) {
                    upi.setStatus({
                        status: 'error',
                        detail: `scanning global-db/user-db failed: ${error}`
                    });
                }
            },
            onResponse: async (_response) => {
                const upi = await this.getUPI();
                if (upi) {
                    upi.setStatus({
                        status: 'ready',
                        detail: 'scanned global-db/user-db'
                    });
                }
            }
        });
        return backend;
    }
    async initBackend() {
        if (!this.backend) {
            this.backend = await this.createBackend();
        }
        return this.backend;
    }
    async createBackend() {
        const backend = await hsdev_process_real_factory_1.createHsDevProcessReal();
        this.disposables.add(backend.onError((arg) => this.emitter.emit('error', arg)), backend.onWarning((arg) => this.emitter.emit('warning', arg)));
        return backend;
    }
}
exports.HsDevProcess = HsDevProcess;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi9zcmMvaHNkZXYvaW5kZXgudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFBQSwrQkFDK0M7QUFDL0MsZ0NBQStCO0FBTy9CLDZEQUFvRjtBQUNwRiw2RUFBcUU7QUFhckU7SUFjRSxZQUFvQixVQUFxQztRQUFyQyxlQUFVLEdBQVYsVUFBVSxDQUEyQjtRQUN2RCxJQUFJLENBQUMsV0FBVyxHQUFHLElBQUksMEJBQW1CLEVBQUUsQ0FBQTtRQUM1QyxJQUFJLENBQUMsT0FBTyxHQUFHLElBQUksY0FBTyxFQUFFLENBQUE7UUFDNUIsSUFBSSxDQUFDLFdBQVcsQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxDQUFBO1FBQ2xDLElBQUksQ0FBQyxZQUFZLEdBQUcsSUFBSSxPQUFPLEVBQUUsQ0FBQTtRQUNqQyxJQUFJLENBQUMsT0FBTyxHQUFHLElBQUksQ0FBQyxZQUFZLEVBQUUsQ0FBQTtJQUNwQyxDQUFDO0lBRU0sS0FBSyxDQUFDLFVBQVUsQ0FBQyxNQUFrQjtRQUN4QyxJQUFJLEdBQUcsQ0FBQTtRQUNQLEdBQUcsR0FBRyxJQUFJLENBQUMsWUFBWSxDQUFDLEdBQUcsQ0FBQyxNQUFNLENBQUMsQ0FBQTtRQUNuQyxFQUFFLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDO1lBQ1IsTUFBTSxDQUFDLEdBQUcsQ0FBQTtRQUNaLENBQUM7UUFDRCxHQUFHLEdBQUcsTUFBTSxJQUFJLENBQUMsVUFBVSxDQUFDLE1BQU0sQ0FBQyxDQUFBO1FBQ25DLElBQUksQ0FBQyxZQUFZLENBQUMsR0FBRyxDQUFDLE1BQU0sRUFBRSxHQUFHLENBQUMsQ0FBQTtRQUNsQyxNQUFNLENBQUMsR0FBRyxDQUFBO0lBQ1osQ0FBQztJQUVNLFdBQVc7UUFDaEIsSUFBSSxDQUFDLE9BQU8sQ0FBQyxXQUFXLEVBQUUsQ0FBQTtJQUM1QixDQUFDO0lBRU0sT0FBTztRQUNaLElBQUksQ0FBQyxPQUFPLENBQUMsT0FBTyxFQUFFLENBQUE7UUFDdEIsSUFBSSxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsYUFBYSxDQUFDLENBQUE7UUFDaEMsSUFBSSxDQUFDLFdBQVcsQ0FBQyxPQUFPLEVBQUUsQ0FBQTtJQUM1QixDQUFDO0lBRU0sWUFBWSxDQUFDLFFBQW9CO1FBQ3RDLE1BQU0sQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLEVBQUUsQ0FBQyxhQUFhLEVBQUUsUUFBUSxDQUFDLENBQUE7SUFDakQsQ0FBQztJQUVNLFNBQVMsQ0FBQyxRQUFtQztRQUNsRCxNQUFNLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxFQUFFLENBQUMsU0FBUyxFQUFFLFFBQVEsQ0FBQyxDQUFBO0lBQzdDLENBQUM7SUFFTSxPQUFPLENBQUMsUUFBNkM7UUFDMUQsTUFBTSxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsRUFBRSxDQUFDLE9BQU8sRUFBRSxRQUFRLENBQUMsQ0FBQTtJQUMzQyxDQUFDO0lBRU0sZUFBZSxDQUFDLFFBQW9CO1FBQ3pDLE1BQU0sQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLEVBQUUsQ0FBQyxnQkFBZ0IsRUFBRSxRQUFRLENBQUMsQ0FBQTtJQUNwRCxDQUFDO0lBRU0sYUFBYSxDQUFDLFFBQW9CO1FBQ3ZDLE1BQU0sQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLEVBQUUsQ0FBQyxjQUFjLEVBQUUsUUFBUSxDQUFDLENBQUE7SUFDbEQsQ0FBQztJQUVNLFdBQVcsQ0FBQyxRQUFvQjtRQUNyQyxNQUFNLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxFQUFFLENBQUMsWUFBWSxFQUFFLFFBQVEsQ0FBQyxDQUFBO0lBQ2hELENBQUM7SUFFTSxLQUFLLENBQUMsS0FBSyxDQUNoQixNQUFrQixFQUFFLE1BQWE7UUFFakMsTUFBTSxJQUFJLEdBQUcsTUFBTSxDQUFDLE1BQU0sRUFBRSxDQUFBO1FBQzVCLE1BQU0sSUFBSSxHQUFHLE1BQU0sQ0FBQyxLQUFLLENBQUMsR0FBRyxHQUFHLENBQUMsQ0FBQTtRQUNqQyxNQUFNLE1BQU0sR0FBRyxNQUFNLENBQUMsS0FBSyxDQUFDLE1BQU0sR0FBRyxDQUFDLENBQUE7UUFDdEMsTUFBTSxPQUFPLEdBQVUsTUFBTSxJQUFJLENBQUMsT0FBTyxDQUFDLEtBQUssQ0FBQyxJQUFJLEVBQUUsSUFBSSxFQUFFLE1BQU0sQ0FBQyxDQUFBO1FBQ25FLEVBQUUsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxNQUFNLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUN4QixJQUFJLENBQUMsS0FBSyxDQUFDLCtCQUErQixJQUFJLElBQUksSUFBSSxJQUFJLE1BQU0sRUFBRSxDQUFDLENBQUE7WUFDbkUsTUFBTSxLQUFLLENBQUMsK0JBQStCLElBQUksSUFBSSxJQUFJLElBQUksTUFBTSxFQUFFLENBQUMsQ0FBQTtRQUN0RSxDQUFDO1FBQ0QsSUFBSSxDQUFDLENBQUM7WUFDSixNQUFNLEdBQUcsR0FBRyxPQUFPLENBQUMsQ0FBQyxDQUFDLENBQUE7WUFDdEIsTUFBTSxJQUFJLEdBQUcsR0FBRyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUE7WUFDMUIsTUFBTSxLQUFLLEdBQUcsRUFBRSxDQUFBO1lBQ2hCLE1BQU0sQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUM7Z0JBQ2IsS0FBSyxVQUFVLENBQUM7Z0JBQ2hCLEtBQUssUUFBUSxDQUFDO2dCQUNkLEtBQUssYUFBYTtvQkFDaEIsS0FBSyxDQUFDLElBQUksQ0FBQyxHQUFHLEdBQUcsQ0FBQyxFQUFFLENBQUMsSUFBSSxPQUFPLEdBQUcsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsR0FBRyxFQUFFLENBQUMsQ0FBQTtvQkFDdEUsS0FBSyxDQUFBO2dCQUNQLEtBQUssTUFBTSxDQUFDO2dCQUNaLEtBQUssTUFBTSxDQUFDO2dCQUNaLEtBQUssT0FBTyxDQUFDO2dCQUNiLEtBQUssU0FBUztvQkFDWixLQUFLLENBQUMsSUFBSSxDQUFDLEdBQUcsSUFBSSxJQUFJLEdBQUcsQ0FBQyxFQUFFLENBQUMsSUFBSSxFQUFFLENBQUMsQ0FBQTtvQkFDcEMsS0FBSyxDQUFBO2dCQUNQO29CQUNFLEtBQUssQ0FBQyxJQUFJLENBQUMsR0FBRyxHQUFHLENBQUMsRUFBRSxDQUFDLElBQUksRUFBRSxDQUFDLENBQUE7WUFDaEMsQ0FBQztZQUVELEVBQUUsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDO2dCQUNiLEtBQUssQ0FBQyxJQUFJLENBQUMsRUFBRSxFQUFFLE1BQU0sR0FBRyxDQUFDLElBQUksS0FBSyxDQUFDLENBQUE7WUFDckMsQ0FBQztZQUVELEVBQUUsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsTUFBTSxDQUFDLFFBQVEsQ0FBQyxJQUFJLElBQUksR0FBRyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUM7Z0JBQzNDLEtBQUssQ0FBQyxJQUFJLENBQUMsRUFBRSxFQUFFLGlCQUFpQixHQUFHLENBQUMsRUFBRSxDQUFDLE1BQU0sQ0FBQyxRQUFRLENBQUMsSUFBSSxJQUFJLEdBQUcsQ0FBQyxHQUFHLENBQUMsSUFBSSxJQUFJLEdBQUcsQ0FBQyxHQUFHLENBQUMsTUFBTSxFQUFFLENBQUMsQ0FBQTtZQUNsRyxDQUFDO1lBQ0QsTUFBTSxDQUFDLEVBQUMsS0FBSyxFQUFFLE1BQU0sRUFBRSxJQUFJLEVBQUUsS0FBSyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsRUFBQyxDQUFBO1FBQ2hELENBQUM7SUFDSCxDQUFDO0lBRU0sS0FBSyxDQUFDLE1BQU07UUFDakIsSUFBSSxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsTUFBTSxFQUFFLFNBQVMsRUFBRTtZQUNuQyxVQUFVLEVBQUUsQ0FBQyxRQUFhLEVBQUUsRUFBRTtnQkFDNUIsSUFBSSxDQUFDLEtBQUssQ0FBQyxxQkFBcUIsSUFBSSxDQUFDLFNBQVMsQ0FBQyxRQUFRLENBQUMsRUFBRSxDQUFDLENBQUE7WUFDN0QsQ0FBQztTQUNGLENBQUMsQ0FBQTtJQUNKLENBQUM7SUFFTSxLQUFLLENBQUMsWUFBWSxDQUFDLE1BQWtCO1FBQzFDLE1BQU0sSUFBSSxHQUFHLE1BQU0sQ0FBQyxNQUFNLEVBQUUsQ0FBQTtRQUM1QixNQUFNLFFBQVEsR0FBRyxNQUFNLElBQUksQ0FBQyxPQUFPLENBQUMsU0FBUyxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQTtRQUNyRCxNQUFNLENBQUMsSUFBSSxDQUFDLGVBQWUsQ0FBQyxRQUFRLENBQUMsQ0FBQTtJQUN2QyxDQUFDO0lBRU0sS0FBSyxDQUFDLEtBQUssQ0FBQyxNQUFrQjtRQUNuQyxNQUFNLElBQUksR0FBRyxNQUFNLENBQUMsTUFBTSxFQUFFLENBQUE7UUFDNUIsTUFBTSxRQUFRLEdBQUcsTUFBTSxJQUFJLENBQUMsT0FBTyxDQUFDLEtBQUssQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUE7UUFDakQsTUFBTSxDQUFDLElBQUksQ0FBQyxlQUFlLENBQUMsUUFBUSxDQUFDLENBQUE7SUFDdkMsQ0FBQztJQUVNLEtBQUssQ0FBQyxJQUFJLENBQUMsTUFBa0I7UUFDbEMsTUFBTSxJQUFJLEdBQUcsTUFBTSxDQUFDLE1BQU0sRUFBRSxDQUFBO1FBQzVCLE1BQU0sUUFBUSxHQUFHLE1BQU0sSUFBSSxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFBO1FBQ2hELE1BQU0sQ0FBQyxJQUFJLENBQUMsZUFBZSxDQUFDLFFBQVEsQ0FBQyxDQUFBO0lBQ3ZDLENBQUM7SUFFTyxlQUFlLENBQUMsUUFBZTtRQUNyQyxNQUFNLE1BQU0sR0FBc0IsRUFBRSxDQUFBO1FBQ3BDLEdBQUcsQ0FBQyxDQUFDLE1BQU0sT0FBTyxJQUFJLFFBQVEsQ0FBQyxDQUFDLENBQUM7WUFDL0IsTUFBTSxHQUFHLEdBQUcsQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLFVBQVUsSUFBSSxPQUFPLENBQUMsS0FBSyxJQUFJLE1BQU0sQ0FBQyxDQUFDLENBQUMsQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxLQUFLLENBQUE7WUFDekYsTUFBTSxLQUFLLEdBQWEsQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxDQUFBO1lBQzlDLEVBQUUsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDLENBQUMsQ0FBQztnQkFDNUIsTUFBTSxPQUFPLEdBQWEsT0FBTyxDQUFDLElBQUksQ0FBQyxVQUFVLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxDQUFBO2dCQUM3RCxFQUFFLENBQUMsQ0FBQyxPQUFPLENBQUMsTUFBTSxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUM7b0JBQ3hCLEtBQUssQ0FBQyxJQUFJLENBQUMsWUFBWSxPQUFPLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFBO2dCQUN0QyxDQUFDO2dCQUNELElBQUksQ0FBQyxDQUFDO29CQUNKLEtBQUssQ0FBQyxJQUFJLENBQUMsVUFBVSxFQUFFLEdBQUcsT0FBTyxDQUFDLENBQUE7Z0JBQ3BDLENBQUM7WUFDSCxDQUFDO1lBQ0QsSUFBSSxDQUFDLEtBQUssRUFBRSxDQUFBO1lBQ1osTUFBTSxDQUFDLElBQUksQ0FBQztnQkFDVixHQUFHLEVBQUUsT0FBTyxDQUFDLE1BQU0sQ0FBQyxJQUFJO2dCQUN4QixRQUFRLEVBQUUsSUFBSSxZQUFLLENBQUMsT0FBTyxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsSUFBSSxHQUFHLENBQUMsRUFBRSxPQUFPLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxNQUFNLEdBQUcsQ0FBQyxDQUFDO2dCQUNqRixRQUFRLEVBQUUsR0FBRztnQkFDYixPQUFPLEVBQUUsS0FBSyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUM7YUFDMUIsQ0FBQyxDQUFBO1FBQ0osQ0FBQztRQUNELE1BQU0sQ0FBQyxNQUFNLENBQUE7SUFDZixDQUFDO0lBRU8sS0FBSyxDQUFDLE1BQU07UUFDbEIsTUFBTSxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsQ0FBQyxJQUFJLENBQUMsVUFBVSxFQUFFLE9BQU8sQ0FBQyxPQUFPLENBQUMsU0FBUyxDQUFDLENBQUMsQ0FBQyxDQUFBO0lBQ3BFLENBQUM7SUFFTyxZQUFZO1FBQ2xCLE1BQU0sT0FBTyxHQUFHLElBQUkscUNBQWdCLEVBQUUsQ0FBQTtRQUN0QyxPQUFPLENBQUMsU0FBUyxDQUFDO1lBQ2hCLFFBQVEsRUFBRSxLQUFLLEVBQUUsYUFBa0IsRUFBRSxFQUFFO2dCQUNyQyxNQUFNLEdBQUcsR0FBRyxNQUFNLElBQUksQ0FBQyxNQUFNLEVBQUUsQ0FBQTtnQkFDL0IsRUFBRSxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQztvQkFDUixHQUFHLENBQUMsU0FBUyxDQUFDO3dCQUNaLE1BQU0sRUFBRSxVQUFVO3dCQUNsQixNQUFNLEVBQUUsNEJBQTRCO3FCQUNyQyxDQUFDLENBQUE7Z0JBQ0osQ0FBQztZQUNILENBQUM7WUFDRCxPQUFPLEVBQUUsS0FBSyxFQUFFLEtBQWEsRUFBRSxRQUFhLEVBQUUsRUFBRTtnQkFDOUMsTUFBTSxHQUFHLEdBQUcsTUFBTSxJQUFJLENBQUMsTUFBTSxFQUFFLENBQUE7Z0JBQy9CLEVBQUUsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUM7b0JBQ1IsR0FBRyxDQUFDLFNBQVMsQ0FBQzt3QkFDWixNQUFNLEVBQUUsT0FBTzt3QkFDZixNQUFNLEVBQUUsc0NBQXNDLEtBQUssRUFBRTtxQkFDdEQsQ0FBQyxDQUFBO2dCQUNKLENBQUM7WUFDSCxDQUFDO1lBQ0QsVUFBVSxFQUFFLEtBQUssRUFBRSxTQUFjLEVBQUUsRUFBRTtnQkFDbkMsTUFBTSxHQUFHLEdBQUcsTUFBTSxJQUFJLENBQUMsTUFBTSxFQUFFLENBQUE7Z0JBQy9CLEVBQUUsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUM7b0JBQ1IsR0FBRyxDQUFDLFNBQVMsQ0FBQzt3QkFDWixNQUFNLEVBQUUsT0FBTzt3QkFDZixNQUFNLEVBQUUsMkJBQTJCO3FCQUNwQyxDQUFDLENBQUE7Z0JBQ0osQ0FBQztZQUNILENBQUM7U0FDRixDQUFDLENBQUE7UUFDRixNQUFNLENBQUMsT0FBTyxDQUFBO0lBQ2hCLENBQUM7SUFFTyxLQUFLLENBQUMsV0FBVztRQUN2QixFQUFFLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDO1lBQ2xCLElBQUksQ0FBQyxPQUFPLEdBQUcsTUFBTSxJQUFJLENBQUMsYUFBYSxFQUFFLENBQUE7UUFDM0MsQ0FBQztRQUNELE1BQU0sQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFBO0lBQ3JCLENBQUM7SUFFTyxLQUFLLENBQUMsYUFBYTtRQUN6QixNQUFNLE9BQU8sR0FBRyxNQUFNLG1EQUFzQixFQUFFLENBQUE7UUFDOUMsSUFBSSxDQUFDLFdBQVcsQ0FBQyxHQUFHLENBQ2xCLE9BQU8sQ0FBQyxPQUFPLENBQUMsQ0FBQyxHQUFHLEVBQUUsRUFBRSxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLE9BQU8sRUFBRSxHQUFHLENBQUMsQ0FBQyxFQUN6RCxPQUFPLENBQUMsU0FBUyxDQUFDLENBQUMsR0FBRyxFQUFFLEVBQUUsQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxTQUFTLEVBQUUsR0FBRyxDQUFDLENBQUMsQ0FDOUQsQ0FBQTtRQUNELE1BQU0sQ0FBQyxPQUFPLENBQUE7SUFDaEIsQ0FBQztDQUNGO0FBck5ELG9DQXFOQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IFJhbmdlLCBQb2ludCwgRW1pdHRlciwgQ29tcG9zaXRlRGlzcG9zYWJsZSxcclxuVGV4dEJ1ZmZlciwgRGlyZWN0b3J5LCBUZXh0RWRpdG9yIH0gZnJvbSAnYXRvbSdcclxuaW1wb3J0ICogYXMgVXRpbCBmcm9tICcuLi91dGlsJ1xyXG5pbXBvcnQgeyBleHRuYW1lIH0gZnJvbSAncGF0aCdcclxuaW1wb3J0IFF1ZXVlID0gcmVxdWlyZSgncHJvbWlzZS1xdWV1ZScpXHJcbmltcG9ydCB7IHVubGl0IH0gZnJvbSAnYXRvbS1oYXNrZWxsLXV0aWxzJ1xyXG5pbXBvcnQgKiBhcyBDb21wbGV0aW9uQmFja2VuZCBmcm9tICdhdG9tLWhhc2tlbGwtdXBpL2NvbXBsZXRpb24tYmFja2VuZCdcclxuaW1wb3J0ICogYXMgVVBJIGZyb20gJ2F0b20taGFza2VsbC11cGknXHJcblxyXG5pbXBvcnQgeyBIc0RldlByb2Nlc3NSZWFsLCBSdW5BcmdzLCBJRXJyb3JDYWxsYmFja0FyZ3MgfSBmcm9tICcuL2hzZGV2LXByb2Nlc3MtcmVhbCdcclxuaW1wb3J0IHsgY3JlYXRlSHNEZXZQcm9jZXNzUmVhbCB9IGZyb20gJy4vaHNkZXYtcHJvY2Vzcy1yZWFsLWZhY3RvcnknXHJcblxyXG5leHBvcnQgeyBJRXJyb3JDYWxsYmFja0FyZ3MsIFJ1bkFyZ3MgfVxyXG5cclxudHlwZSBDb21tYW5kcyA9ICdjaGVja2xpbnQnIHwgJ2Jyb3dzZScgfCAndHlwZWluZm8nIHwgJ2ZpbmQnIHwgJ2luaXQnIHwgJ2xpc3QnIHwgJ2xvd21lbSdcclxuXHJcbmV4cG9ydCBpbnRlcmZhY2UgU3ltYm9sRGVzYyB7XHJcbiAgbmFtZTogc3RyaW5nLFxyXG4gIHN5bWJvbFR5cGU6IENvbXBsZXRpb25CYWNrZW5kLlN5bWJvbFR5cGUsXHJcbiAgdHlwZVNpZ25hdHVyZT86IHN0cmluZyxcclxuICBwYXJlbnQ/OiBzdHJpbmdcclxufVxyXG5cclxuZXhwb3J0IGNsYXNzIEhzRGV2UHJvY2VzcyB7XHJcbiAgcHVibGljIGJhY2tlbmQ6IEhzRGV2UHJvY2Vzc1JlYWxcclxuICBwcml2YXRlIGRpc3Bvc2FibGVzOiBDb21wb3NpdGVEaXNwb3NhYmxlXHJcbiAgcHJpdmF0ZSBlbWl0dGVyOiBFbWl0dGVyPHtcclxuICAgICdkaWQtZGVzdHJveSc6IHVuZGVmaW5lZFxyXG4gICAgJ2JhY2tlbmQtYWN0aXZlJzogdW5kZWZpbmVkXHJcbiAgICAnYmFja2VuZC1pZGxlJzogdW5kZWZpbmVkXHJcbiAgfSwge1xyXG4gICAgJ3dhcm5pbmcnOiBzdHJpbmdcclxuICAgICdlcnJvcic6IElFcnJvckNhbGxiYWNrQXJnc1xyXG4gICAgJ3F1ZXVlLWlkbGUnOiB7IHF1ZXVlOiBDb21tYW5kcyB9XHJcbiAgfT5cclxuICBwcml2YXRlIGJ1ZmZlckRpck1hcDogV2Vha01hcDxUZXh0QnVmZmVyLCBEaXJlY3Rvcnk+XHJcblxyXG4gIGNvbnN0cnVjdG9yKHByaXZhdGUgdXBpUHJvbWlzZTogUHJvbWlzZTxVUEkuSVVQSUluc3RhbmNlPikge1xyXG4gICAgdGhpcy5kaXNwb3NhYmxlcyA9IG5ldyBDb21wb3NpdGVEaXNwb3NhYmxlKClcclxuICAgIHRoaXMuZW1pdHRlciA9IG5ldyBFbWl0dGVyKClcclxuICAgIHRoaXMuZGlzcG9zYWJsZXMuYWRkKHRoaXMuZW1pdHRlcilcclxuICAgIHRoaXMuYnVmZmVyRGlyTWFwID0gbmV3IFdlYWtNYXAoKVxyXG4gICAgdGhpcy5iYWNrZW5kID0gdGhpcy5zdGFydEJhY2tlbmQoKVxyXG4gIH1cclxuXHJcbiAgcHVibGljIGFzeW5jIGdldFJvb3REaXIoYnVmZmVyOiBUZXh0QnVmZmVyKTogUHJvbWlzZTxEaXJlY3Rvcnk+IHtcclxuICAgIGxldCBkaXJcclxuICAgIGRpciA9IHRoaXMuYnVmZmVyRGlyTWFwLmdldChidWZmZXIpXHJcbiAgICBpZiAoZGlyKSB7XHJcbiAgICAgIHJldHVybiBkaXJcclxuICAgIH1cclxuICAgIGRpciA9IGF3YWl0IFV0aWwuZ2V0Um9vdERpcihidWZmZXIpXHJcbiAgICB0aGlzLmJ1ZmZlckRpck1hcC5zZXQoYnVmZmVyLCBkaXIpXHJcbiAgICByZXR1cm4gZGlyXHJcbiAgfVxyXG5cclxuICBwdWJsaWMga2lsbFByb2Nlc3MoKSB7XHJcbiAgICB0aGlzLmJhY2tlbmQua2lsbFByb2Nlc3MoKVxyXG4gIH1cclxuXHJcbiAgcHVibGljIGRlc3Ryb3koKSB7XHJcbiAgICB0aGlzLmJhY2tlbmQuZGVzdHJveSgpXHJcbiAgICB0aGlzLmVtaXR0ZXIuZW1pdCgnZGlkLWRlc3Ryb3knKVxyXG4gICAgdGhpcy5kaXNwb3NhYmxlcy5kaXNwb3NlKClcclxuICB9XHJcblxyXG4gIHB1YmxpYyBvbkRpZERlc3Ryb3koY2FsbGJhY2s6ICgpID0+IHZvaWQpIHtcclxuICAgIHJldHVybiB0aGlzLmVtaXR0ZXIub24oJ2RpZC1kZXN0cm95JywgY2FsbGJhY2spXHJcbiAgfVxyXG5cclxuICBwdWJsaWMgb25XYXJuaW5nKGNhbGxiYWNrOiAod2FybmluZzogc3RyaW5nKSA9PiB2b2lkKSB7XHJcbiAgICByZXR1cm4gdGhpcy5lbWl0dGVyLm9uKCd3YXJuaW5nJywgY2FsbGJhY2spXHJcbiAgfVxyXG5cclxuICBwdWJsaWMgb25FcnJvcihjYWxsYmFjazogKGVycm9yOiBJRXJyb3JDYWxsYmFja0FyZ3MpID0+IHZvaWQpIHtcclxuICAgIHJldHVybiB0aGlzLmVtaXR0ZXIub24oJ2Vycm9yJywgY2FsbGJhY2spXHJcbiAgfVxyXG5cclxuICBwdWJsaWMgb25CYWNrZW5kQWN0aXZlKGNhbGxiYWNrOiAoKSA9PiB2b2lkKSB7XHJcbiAgICByZXR1cm4gdGhpcy5lbWl0dGVyLm9uKCdiYWNrZW5kLWFjdGl2ZScsIGNhbGxiYWNrKVxyXG4gIH1cclxuXHJcbiAgcHVibGljIG9uQmFja2VuZElkbGUoY2FsbGJhY2s6ICgpID0+IHZvaWQpIHtcclxuICAgIHJldHVybiB0aGlzLmVtaXR0ZXIub24oJ2JhY2tlbmQtaWRsZScsIGNhbGxiYWNrKVxyXG4gIH1cclxuXHJcbiAgcHVibGljIG9uUXVldWVJZGxlKGNhbGxiYWNrOiAoKSA9PiB2b2lkKSB7XHJcbiAgICByZXR1cm4gdGhpcy5lbWl0dGVyLm9uKCdxdWV1ZS1pZGxlJywgY2FsbGJhY2spXHJcbiAgfVxyXG5cclxuICBwdWJsaWMgYXN5bmMgd2hvYXQoXHJcbiAgICBidWZmZXI6IFRleHRCdWZmZXIsIGNyYW5nZTogUmFuZ2VcclxuICApIHtcclxuICAgIGNvbnN0IGZpbGUgPSBidWZmZXIuZ2V0VXJpKClcclxuICAgIGNvbnN0IGxpbmUgPSBjcmFuZ2Uuc3RhcnQucm93ICsgMVxyXG4gICAgY29uc3QgY29sdW1uID0gY3JhbmdlLnN0YXJ0LmNvbHVtbiArIDFcclxuICAgIGNvbnN0IHN5bWJvbHM6IGFueVtdID0gYXdhaXQgdGhpcy5iYWNrZW5kLndob2F0KGZpbGUsIGxpbmUsIGNvbHVtbilcclxuICAgIGlmIChzeW1ib2xzLmxlbmd0aCA9PSAwKSB7XHJcbiAgICAgIFV0aWwuZGVidWcoYE5vIGluZm8gZm91bmQgZm9yIHN5bWJvbCBhdCAke2ZpbGV9ICR7bGluZX0gJHtjb2x1bW59YClcclxuICAgICAgdGhyb3cgRXJyb3IoYE5vIGluZm8gZm91bmQgZm9yIHN5bWJvbCBhdCAke2ZpbGV9ICR7bGluZX0gJHtjb2x1bW59YClcclxuICAgIH1cclxuICAgIGVsc2Uge1xyXG4gICAgICBjb25zdCBzeW0gPSBzeW1ib2xzWzBdXHJcbiAgICAgIGNvbnN0IHdoYXQgPSBzeW0uaW5mby53aGF0XHJcbiAgICAgIGNvbnN0IGxpbmVzID0gW11cclxuICAgICAgc3dpdGNoICh3aGF0KSB7XHJcbiAgICAgICAgY2FzZSAnZnVuY3Rpb24nOlxyXG4gICAgICAgIGNhc2UgJ21ldGhvZCc6XHJcbiAgICAgICAgY2FzZSAnY29uc3RydWN0b3InOlxyXG4gICAgICAgICAgbGluZXMucHVzaChgJHtzeW0uaWQubmFtZX0gOjogJHtzeW0uaW5mby50eXBlID8gc3ltLmluZm8udHlwZSA6ICc/J31gKVxyXG4gICAgICAgICAgYnJlYWtcclxuICAgICAgICBjYXNlICdkYXRhJzpcclxuICAgICAgICBjYXNlICd0eXBlJzpcclxuICAgICAgICBjYXNlICdjbGFzcyc6XHJcbiAgICAgICAgY2FzZSAnbmV3dHlwZSc6XHJcbiAgICAgICAgICBsaW5lcy5wdXNoKGAke3doYXR9ICR7c3ltLmlkLm5hbWV9YClcclxuICAgICAgICAgIGJyZWFrXHJcbiAgICAgICAgZGVmYXVsdDpcclxuICAgICAgICAgIGxpbmVzLnB1c2goYCR7c3ltLmlkLm5hbWV9YClcclxuICAgICAgfVxyXG5cclxuICAgICAgaWYgKHN5bS5kb2NzKSB7XHJcbiAgICAgICAgbGluZXMucHVzaCgnJywgYHstICR7c3ltLmRvY3N9IC19YClcclxuICAgICAgfVxyXG5cclxuICAgICAgaWYgKHN5bS5pZC5tb2R1bGUubG9jYXRpb24uZmlsZSAmJiBzeW0ucG9zKSB7XHJcbiAgICAgICAgbGluZXMucHVzaCgnJywgYC0tIERlZmluZWQgaW4gJHtzeW0uaWQubW9kdWxlLmxvY2F0aW9uLmZpbGV9OiR7c3ltLnBvcy5saW5lfToke3N5bS5wb3MuY29sdW1ufWApXHJcbiAgICAgIH1cclxuICAgICAgcmV0dXJuIHtyYW5nZTogY3JhbmdlLCBpbmZvOiBsaW5lcy5qb2luKCdcXG4nKX1cclxuICAgIH1cclxuICB9XHJcblxyXG4gIHB1YmxpYyBhc3luYyBkb1BpbmcoKSB7XHJcbiAgICB0aGlzLmJhY2tlbmQuY2FsbCgncGluZycsIHVuZGVmaW5lZCwge1xyXG4gICAgICBvblJlc3BvbnNlOiAocmVzcG9uc2U6IGFueSkgPT4ge1xyXG4gICAgICAgIFV0aWwuZGVidWcoYHJlc3BvbnNlIHRvIHBpbmc6ICR7SlNPTi5zdHJpbmdpZnkocmVzcG9uc2UpfWApXHJcbiAgICAgIH1cclxuICAgIH0pXHJcbiAgfVxyXG5cclxuICBwdWJsaWMgYXN5bmMgY2hlY2tBbmRMaW50KGJ1ZmZlcjogVGV4dEJ1ZmZlcikge1xyXG4gICAgY29uc3QgZmlsZSA9IGJ1ZmZlci5nZXRVcmkoKVxyXG4gICAgY29uc3QgbWVzc2FnZXMgPSBhd2FpdCB0aGlzLmJhY2tlbmQuY2hlY2tMaW50KFtmaWxlXSlcclxuICAgIHJldHVybiB0aGlzLmNvbnZlcnRNZXNzYWdlcyhtZXNzYWdlcylcclxuICB9XHJcblxyXG4gIHB1YmxpYyBhc3luYyBjaGVjayhidWZmZXI6IFRleHRCdWZmZXIpIHtcclxuICAgIGNvbnN0IGZpbGUgPSBidWZmZXIuZ2V0VXJpKClcclxuICAgIGNvbnN0IG1lc3NhZ2VzID0gYXdhaXQgdGhpcy5iYWNrZW5kLmNoZWNrKFtmaWxlXSlcclxuICAgIHJldHVybiB0aGlzLmNvbnZlcnRNZXNzYWdlcyhtZXNzYWdlcylcclxuICB9XHJcblxyXG4gIHB1YmxpYyBhc3luYyBsaW50KGJ1ZmZlcjogVGV4dEJ1ZmZlcikge1xyXG4gICAgY29uc3QgZmlsZSA9IGJ1ZmZlci5nZXRVcmkoKVxyXG4gICAgY29uc3QgbWVzc2FnZXMgPSBhd2FpdCB0aGlzLmJhY2tlbmQubGludChbZmlsZV0pXHJcbiAgICByZXR1cm4gdGhpcy5jb252ZXJ0TWVzc2FnZXMobWVzc2FnZXMpXHJcbiAgfVxyXG5cclxuICBwcml2YXRlIGNvbnZlcnRNZXNzYWdlcyhtZXNzYWdlczogYW55W10pOiBVUEkuSVJlc3VsdEl0ZW1bXSB7XHJcbiAgICBjb25zdCByZXN1bHQ6IFVQSS5JUmVzdWx0SXRlbVtdID0gW11cclxuICAgIGZvciAoY29uc3QgbWVzc2FnZSBvZiBtZXNzYWdlcykge1xyXG4gICAgICBjb25zdCBzZXYgPSAobWVzc2FnZS5ub3RlLnN1Z2dlc3Rpb24gfHwgbWVzc2FnZS5sZXZlbCA9PSAnaGludCcpID8gJ2xpbnQnIDogbWVzc2FnZS5sZXZlbFxyXG4gICAgICBjb25zdCBsaW5lczogc3RyaW5nW10gPSBbbWVzc2FnZS5ub3RlLm1lc3NhZ2VdXHJcbiAgICAgIGlmIChtZXNzYWdlLm5vdGUuc3VnZ2VzdGlvbikge1xyXG4gICAgICAgIGNvbnN0IHN1Z2dlc3Q6IHN0cmluZ1tdID0gbWVzc2FnZS5ub3RlLnN1Z2dlc3Rpb24uc3BsaXQoJ1xcbicpXHJcbiAgICAgICAgaWYgKHN1Z2dlc3QubGVuZ3RoID09IDEpIHtcclxuICAgICAgICAgIGxpbmVzLnB1c2goYFdoeSBub3Q6ICR7c3VnZ2VzdFswXX1gKVxyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgIGxpbmVzLnB1c2goJ1doeSBub3Q6JywgLi4uc3VnZ2VzdClcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgICAgVXRpbC5kZWJ1ZygpXHJcbiAgICAgIHJlc3VsdC5wdXNoKHtcclxuICAgICAgICB1cmk6IG1lc3NhZ2Uuc291cmNlLmZpbGUsXHJcbiAgICAgICAgcG9zaXRpb246IG5ldyBQb2ludChtZXNzYWdlLnJlZ2lvbi5mcm9tLmxpbmUgLSAxLCBtZXNzYWdlLnJlZ2lvbi5mcm9tLmNvbHVtbiAtIDEpLFxyXG4gICAgICAgIHNldmVyaXR5OiBzZXYsXHJcbiAgICAgICAgbWVzc2FnZTogbGluZXMuam9pbignXFxuJylcclxuICAgICAgfSlcclxuICAgIH1cclxuICAgIHJldHVybiByZXN1bHRcclxuICB9XHJcblxyXG4gIHByaXZhdGUgYXN5bmMgZ2V0VVBJKCkge1xyXG4gICAgcmV0dXJuIFByb21pc2UucmFjZShbdGhpcy51cGlQcm9taXNlLCBQcm9taXNlLnJlc29sdmUodW5kZWZpbmVkKV0pXHJcbiAgfVxyXG5cclxuICBwcml2YXRlIHN0YXJ0QmFja2VuZCgpOiBIc0RldlByb2Nlc3NSZWFsIHtcclxuICAgIGNvbnN0IGJhY2tlbmQgPSBuZXcgSHNEZXZQcm9jZXNzUmVhbCgpXHJcbiAgICBiYWNrZW5kLnNjYW5DYWJhbCh7XHJcbiAgICAgIG9uTm90aWZ5OiBhc3luYyAoX25vdGlmaWNhdGlvbjogYW55KSA9PiB7XHJcbiAgICAgICAgY29uc3QgdXBpID0gYXdhaXQgdGhpcy5nZXRVUEkoKVxyXG4gICAgICAgIGlmICh1cGkpIHtcclxuICAgICAgICAgIHVwaS5zZXRTdGF0dXMoe1xyXG4gICAgICAgICAgICBzdGF0dXM6ICdwcm9ncmVzcycsXHJcbiAgICAgICAgICAgIGRldGFpbDogJ3NjYW5uaW5nIGdsb2JhbC1kYi91c2VyLWRiJ1xyXG4gICAgICAgICAgfSlcclxuICAgICAgICB9XHJcbiAgICAgIH0sXHJcbiAgICAgIG9uRXJyb3I6IGFzeW5jIChlcnJvcjogc3RyaW5nLCBfZGV0YWlsczogYW55KSA9PiB7XHJcbiAgICAgICAgY29uc3QgdXBpID0gYXdhaXQgdGhpcy5nZXRVUEkoKVxyXG4gICAgICAgIGlmICh1cGkpIHtcclxuICAgICAgICAgIHVwaS5zZXRTdGF0dXMoe1xyXG4gICAgICAgICAgICBzdGF0dXM6ICdlcnJvcicsXHJcbiAgICAgICAgICAgIGRldGFpbDogYHNjYW5uaW5nIGdsb2JhbC1kYi91c2VyLWRiIGZhaWxlZDogJHtlcnJvcn1gXHJcbiAgICAgICAgICB9KVxyXG4gICAgICAgIH1cclxuICAgICAgfSxcclxuICAgICAgb25SZXNwb25zZTogYXN5bmMgKF9yZXNwb25zZTogYW55KSA9PiB7XHJcbiAgICAgICAgY29uc3QgdXBpID0gYXdhaXQgdGhpcy5nZXRVUEkoKVxyXG4gICAgICAgIGlmICh1cGkpIHtcclxuICAgICAgICAgIHVwaS5zZXRTdGF0dXMoe1xyXG4gICAgICAgICAgICBzdGF0dXM6ICdyZWFkeScsXHJcbiAgICAgICAgICAgIGRldGFpbDogJ3NjYW5uZWQgZ2xvYmFsLWRiL3VzZXItZGInXHJcbiAgICAgICAgICB9KVxyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgfSlcclxuICAgIHJldHVybiBiYWNrZW5kXHJcbiAgfVxyXG5cclxuICBwcml2YXRlIGFzeW5jIGluaXRCYWNrZW5kKCk6IFByb21pc2U8SHNEZXZQcm9jZXNzUmVhbD4ge1xyXG4gICAgaWYgKCF0aGlzLmJhY2tlbmQpIHtcclxuICAgICAgdGhpcy5iYWNrZW5kID0gYXdhaXQgdGhpcy5jcmVhdGVCYWNrZW5kKClcclxuICAgIH1cclxuICAgIHJldHVybiB0aGlzLmJhY2tlbmRcclxuICB9XHJcblxyXG4gIHByaXZhdGUgYXN5bmMgY3JlYXRlQmFja2VuZCgpOiBQcm9taXNlPEhzRGV2UHJvY2Vzc1JlYWw+IHtcclxuICAgIGNvbnN0IGJhY2tlbmQgPSBhd2FpdCBjcmVhdGVIc0RldlByb2Nlc3NSZWFsKClcclxuICAgIHRoaXMuZGlzcG9zYWJsZXMuYWRkKFxyXG4gICAgICBiYWNrZW5kLm9uRXJyb3IoKGFyZykgPT4gdGhpcy5lbWl0dGVyLmVtaXQoJ2Vycm9yJywgYXJnKSksXHJcbiAgICAgIGJhY2tlbmQub25XYXJuaW5nKChhcmcpID0+IHRoaXMuZW1pdHRlci5lbWl0KCd3YXJuaW5nJywgYXJnKSksXHJcbiAgICApXHJcbiAgICByZXR1cm4gYmFja2VuZFxyXG4gIH1cclxufVxyXG4iXX0=